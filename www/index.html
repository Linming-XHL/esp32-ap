<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ESP32配置</title>
<style>
body{font-family:sans-serif;margin:10px}
input,select{width:98%;padding:5px;margin:5px 0}
button{width:100%;padding:8px;background:green;color:white;border:none}
.status{padding:10px;margin:10px 0;text-align:center}
</style>
</head>
<body>
<h1>ESP32配置</h1>
<form id="f">
<h3>上游网络</h3>
<label>SSID:</label><input id="sta_ssid" name="sta_ssid" placeholder="Wi-Fi名称">
<label>密码:</label><input type="password" id="sta_password" name="sta_password">

<h3>热点设置</h3>
<label>热点SSID:</label><input id="ap_ssid" name="ap_ssid" value="ESP32_Repeater">
<label>热点密码:</label><input type="password" id="ap_password" name="ap_password" value="12345678">

<h3>蓝牙设置</h3>
<label>蓝牙:</label><select id="bt_enabled" name="bt_enabled">
<option value="0">禁用</option>
<option value="1">启用</option>
</select>
<label>蓝牙名称:</label><input id="bt_name" name="bt_name" value="ESP32_Audio">
<label>音量:</label><input type="range" id="bt_volume" name="bt_volume" min="0" max="100" value="70">

<button type="submit">保存并重启</button>
<div id="s" class="status"></div>
</form>
<script>
window.onload=function(){fetch('/config').then(r=>r.json()).then(d=>{
if(d.ssid)document.getElementById('sta_ssid').value=d.ssid;
if(d.passwd)document.getElementById('sta_password').value=d.passwd;
if(d.ap_ssid)document.getElementById('ap_ssid').value=d.ap_ssid;
if(d.ap_passwd)document.getElementById('ap_password').value=d.ap_passwd;
if(d.bt_enabled!==undefined)document.getElementById('bt_enabled').value=d.bt_enabled?1:0;
if(d.bt_name)document.getElementById('bt_name').value=d.bt_name;
if(d.bt_volume!==undefined)document.getElementById('bt_volume').value=d.bt_volume;
})};

function submit(e){e.preventDefault();
const b=document.querySelector('button');
const s=document.getElementById('s');
b.disabled=true;
b.textContent='保存中...';s.innerHTML='';
const d={sta_ssid:document.getElementById('sta_ssid').value,sta_password:document.getElementById('sta_password').value,ap_ssid:document.getElementById('ap_ssid').value,ap_password:document.getElementById('ap_password').value,bt_enabled:document.getElementById('bt_enabled').value,bt_name:document.getElementById('bt_name').value,bt_volume:document.getElementById('bt_volume').value};
fetch('/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)}).then(r=>r.json()).then(res=>{
if(res.success){s.className='status';s.textContent='配置已保存，设备将重启';}else{s.className='status';s.textContent='保存失败';b.disabled=false;b.textContent='保存并重启';}}).catch(err=>{s.className='status';s.textContent='网络错误';b.disabled=false;b.textContent='保存并重启';});}
document.getElementById('f').addEventListener('submit',submit);
</script>
</body>
</html>
